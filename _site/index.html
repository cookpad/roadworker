<!DOCTYPE html>
<html>

  <head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="description" content="Roadworker is a tool to manage Route53. It defines the state of Route53 using DSL, and updates Route53 according to DSL.">

  <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

  <title>Roadworker</title>
</head>


  <body>

    <header class="inner">
  <h1 id="project_title">Roadworker</h1>
  <h2 id="project_tagline">Roadworker is a tool to manage Route53. It defines the state of Route53 using DSL, and updates Route53 according to DSL.</h2>
</header>


    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p><a href="http://badge.fury.io/rb/roadworker"><img src="https://badge.fury.io/rb/roadworker.png" alt="Gem Version" /></a>
<a href="https://travis-ci.org/winebarrel/roadworker"><img src="https://travis-ci.org/winebarrel/roadworker.svg?branch=master" alt="Build Status" /></a>
<a href="https://coveralls.io/r/winebarrel/roadworker?branch=master"><img src="https://coveralls.io/repos/winebarrel/roadworker/badge.png?branch=master" alt="Coverage Status" /></a></p>

<p><strong>Notice</strong></p>

<ul>
  <li>Roadworker cannot update TTL of two or more same weighted A records (with different SetIdentifier) after creation.</li>
  <li><code>&gt;= 0.4.3</code> compare resource records ignoring the order.</li>
</ul>

<h2 id="installation">Installation</h2>

<p>Add this line to your application’s Gemfile:</p>

<pre><code>gem 'roadworker'
</code></pre>

<p>And then execute:</p>

<pre><code>$ bundle
</code></pre>

<p>Or install it yourself as:</p>

<pre><code>$ gem install roadworker
</code></pre>

<h2 id="usage">Usage</h2>

<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nb">export </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="s1">&#39;...&#39;</span>
<span class="nb">export </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s1">&#39;...&#39;</span>
roadwork -e -o Routefile
vi Routefile
roadwork -a --dry-run
roudwork -a</code></pre></div>

<h2 id="help">Help</h2>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">Usage: roadwork <span class="o">[</span>options<span class="o">]</span>
    -p, --profile PROFILE_NAME
        --credentials-path PATH
    -k, --access-key ACCESS_KEY
    -s, --secret-key SECRET_KEY
    -a, --apply
    -f, --file FILE
        --dry-run
        --force
        --no-health-check-gc
    -e, --export
    -o, --output FILE
        --split
        --with-soa-ns
    -t, --test
        --nameservers SERVERS
        --port PORT
        --target-zone REGEXP
        --no-color
        --debug</code></pre></div>

<h2 id="routefile-example">Routefile example</h2>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;other/routefile&#39;</span>

<span class="n">hosted_zone</span> <span class="s2">&quot;winebarrel.jp.&quot;</span> <span class="k">do</span>
  <span class="n">rrset</span> <span class="s2">&quot;winebarrel.jp.&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span> <span class="k">do</span>
    <span class="n">ttl</span> <span class="mi">300</span>
    <span class="n">resource_records</span><span class="p">(</span>
      <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;127.0.0.2&quot;</span>
    <span class="p">)</span>
  <span class="k">end</span>

  <span class="n">rrset</span> <span class="s2">&quot;winebarrel.jp.&quot;</span><span class="p">,</span> <span class="s2">&quot;MX&quot;</span> <span class="k">do</span>
    <span class="n">ttl</span> <span class="mi">300</span>
    <span class="n">resource_records</span><span class="p">(</span>
      <span class="s2">&quot;10 mx.winebarrel.jp&quot;</span><span class="p">,</span>
      <span class="s2">&quot;10 mx2.winebarrel.jp&quot;</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">hosted_zone</span> <span class="s2">&quot;info.winebarrel.jp.&quot;</span> <span class="k">do</span>
  <span class="n">rrset</span> <span class="s2">&quot;xxx.info.winebarrel.jp.&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span> <span class="k">do</span>
    <span class="n">dns_name</span> <span class="s2">&quot;elb-dns-name.elb.amazonaws.com&quot;</span>
  <span class="k">end</span>

  <span class="n">rrset</span> <span class="s2">&quot;yyy.info.winebarrel.jp.&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span> <span class="k">do</span>
    <span class="n">dns_name</span> <span class="s2">&quot;elb-dns-name2.elb.amazonaws.com&quot;</span><span class="p">,</span> <span class="ss">:evaluate_target_health</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="k">end</span>

  <span class="n">rrset</span> <span class="s2">&quot;zzz.info.winebarrel.jp&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span> <span class="k">do</span>
    <span class="n">set_identifier</span> <span class="s2">&quot;Primary&quot;</span>
    <span class="n">failover</span> <span class="s2">&quot;PRIMARY&quot;</span>
    <span class="n">health_check</span> <span class="s2">&quot;http://example.com:80/path&quot;</span><span class="p">,</span> <span class="ss">:search_string</span> <span class="o">=&gt;</span> <span class="s2">&quot;ANY_RESPONSE_STRING&quot;</span><span class="p">,</span> <span class="ss">:request_interval</span> <span class="o">=&gt;</span> <span class="mi">30</span><span class="p">,</span> <span class="ss">:failure_threshold</span> <span class="o">=&gt;</span> <span class="mi">3</span>
    <span class="c1"># If you want to specify the IP address:</span>
    <span class="c1">#health_check &quot;http://192.0.43.10:80/path&quot;, :host =&gt; &quot;example.com&quot;,...</span>
    <span class="n">ttl</span> <span class="mi">456</span>
    <span class="n">resource_records</span><span class="p">(</span>
      <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;127.0.0.2&quot;</span>
    <span class="p">)</span>
  <span class="k">end</span>

  <span class="n">rrset</span> <span class="s2">&quot;zzz.info.winebarrel.jp&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span> <span class="k">do</span>
    <span class="n">set_identifier</span> <span class="s2">&quot;Secondary&quot;</span>
    <span class="n">failover</span> <span class="s2">&quot;SECONDARY&quot;</span>
    <span class="n">health_check</span> <span class="s2">&quot;tcp://192.0.43.10:3306&quot;</span><span class="p">,</span> <span class="ss">:request_interval</span> <span class="o">=&gt;</span> <span class="mi">30</span><span class="p">,</span> <span class="ss">:failure_threshold</span> <span class="o">=&gt;</span> <span class="mi">3</span>
    <span class="n">ttl</span> <span class="mi">456</span>
    <span class="n">resource_records</span><span class="p">(</span>
      <span class="s2">&quot;127.0.0.3&quot;</span><span class="p">,</span>
      <span class="s2">&quot;127.0.0.4&quot;</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Private HostedZone</span>
<span class="n">hosted_zone</span> <span class="s2">&quot;winebarrel.local.&quot;</span> <span class="k">do</span>
  <span class="n">vpc</span> <span class="s2">&quot;us-east-1&quot;</span><span class="p">,</span> <span class="s2">&quot;vpc-xxxxxxxx&quot;</span>
  <span class="n">vpc</span> <span class="s2">&quot;us-east-2&quot;</span><span class="p">,</span> <span class="s2">&quot;vpc-xxxxxxxx&quot;</span>

  <span class="n">rrset</span> <span class="s2">&quot;winebarrel.local.&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span> <span class="k">do</span>
    <span class="n">ttl</span> <span class="mi">300</span>
    <span class="n">resource_records</span><span class="p">(</span>
      <span class="s2">&quot;10.0.0.1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;10.0.0.2&quot;</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<h3 id="dynamic-private-dns-example">Dynamic private DNS example</h3>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">hosted_zone</span> <span class="s2">&quot;us-east-1.my.local.&quot;</span> <span class="k">do</span>
  <span class="n">vpc</span> <span class="s2">&quot;us-east-1&quot;</span><span class="p">,</span> <span class="s2">&quot;vpc-xxxxxxxx&quot;</span>

  <span class="no">AWS</span><span class="o">::</span><span class="no">EC2</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">region</span><span class="p">:</span> <span class="s2">&quot;us-east-1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">vpcs</span><span class="o">[</span><span class="s2">&quot;vpc-xxxxxxxx&quot;</span><span class="o">].</span><span class="n">instances</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">instance</span><span class="o">|</span>
    <span class="n">rrset</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">instance</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">Name</span><span class="si">}</span><span class="s2">.us-east-1.my.local.&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span> <span class="k">do</span>
      <span class="n">ttl</span> <span class="mi">300</span>
      <span class="n">resource_records</span> <span class="n">instance</span><span class="o">.</span><span class="n">private_ip_address</span>
    <span class="k">end</span>
  <span class="p">}</span>
<span class="k">end</span></code></pre></div>

<h2 id="test">Test</h2>

<p>Routefile compares the results of a query to the DNS and DSL in the test mode.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">shell</span><span class="o">&gt;</span> <span class="n">roadwork</span> <span class="o">-</span><span class="n">t</span>
<span class="o">.</span><span class="n">.F</span><span class="o">.</span><span class="n">.</span>
<span class="n">info</span><span class="o">.</span><span class="n">winebarrel</span><span class="o">.</span><span class="n">jp</span><span class="o">.</span> <span class="ss">A</span><span class="p">:</span>
  <span class="n">expected</span><span class="o">=</span><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">3</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
  <span class="n">actual</span><span class="o">=</span><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="mi">5</span> <span class="n">examples</span><span class="p">,</span> <span class="mi">1</span> <span class="n">failure</span></code></pre></div>

<p>(Please note test of A(Alias) is not possible to perfection…)</p>

<h2 id="demo">Demo</h2>

<p><img src="https://raw.githubusercontent.com/winebarrel/roadworker/master/etc/demo.gif" alt="Roadworker Demo" /></p>

<h2 id="dns-management-using-githubbitbucket">DNS management using GitHub/Bitbucket</h2>

<p><img src="https://cacoo.com/diagrams/geJfslZqd8qne90t-BC7C7.png" alt="DNS management using Git" /></p>

<ul>
  <li><a href="https://bitbucket.org/winebarrel/roadworker-example/src">Bitbucket example repository</a></li>
  <li><a href="https://drone.io/bitbucket.org/winebarrel/roadworker-example/latest">drone.io example project</a></li>
</ul>

<h2 id="link">Link</h2>
<ul>
  <li><a href="http://rubygems.org/gems/roadworker">RubyGems.org site</a></li>
</ul>

<h2 id="similar-tools">Similar tools</h2>
<ul>
  <li><a href="http://codenize.tools/">Codenize.tools</a></li>
</ul>

      </section>
    </div>

    <footer class="inner">
  <p class="copyright">Roadworker maintained by <a href="https://github.com/winebarrel">winebarrel</a></p>
  <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
</footer>


  </body>

</html>
